<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>jQuery treeview</title>
    <link rel="stylesheet" href="../jquery.treeview.css" />
    <link rel="stylesheet" href="screen.css" />
    <script src="../lib/jquery.js" type="text/javascript"></script>
    <script src="../lib/jquery.cookie.js" type="text/javascript"></script>
    <script src="../jquery.treeview.js" type="text/javascript"></script>
    <link rel="stylesheet" href="../jquery.treeview.css" />
	<link rel="stylesheet" href="screen.css" />
	<script src="../jquery.treeview.edit.js" type="text/javascript"></script>
    <script type="text/javascript" src="demo.js"></script>
    <style type="text/css">
      .a_update,.a_delete,.a_update_t,.a_add_t
      {
           margin-left:5px;
      }
      li span input[type='text']
      {
           width:100px;
      }
      .a_addTag
      {
          
      }
      
      ul li
      {
          line-height:22px;
          font-size:large;
      }
      li a
      {
          font-size:small;
      }
    </style>

    <script type="text/javascript">
        function a_update_registClick(t) {
                    //修改的 方法
            var txtValue = $(t).text();
                    if (txtValue == "修改") {
                        var m = $(t).parent().parent().find("span").first();
                        var oriTag = $(m).text();
                        $(m).html("<input type = 'text' value='" + oriTag + "'>");
                        $(t).text("保存");
                    } else {
                        var m = $(t).parent().parent().find("span").first();
                        var new_tag = $(m).find("input[type='text']").first().val();
                        $(m).text(new_tag);
                        $(t).text("修改");
                    }
                    return false;
        }
        function a_delete_registClick(t) {
            //删除的方法
            if (confirm("删除不可恢复,确定要删除吗?")) {
                //将在这一个 li 隐藏,然后删除
                $(t).parent().parent().hide();
            }
            return false;
        }

        function a_addTag_registClick(t) {
            var txtValue = $(t).text();
            if (txtValue == "添加标签") {
                var m = $(t).parent().parent().find("span").first();
                $(m).html("<input type = 'text' value=''>");
                $(t).text("保存标签");
                return false;
            } else {
                var m = $(t).parent().parent().find("span").first();
                var tagValue = $(m).find("input[type='text']").first().val().trim();
                if (tagValue == "") {
                    alert("标签内容不能为空");
                } else {
                    var htl = "<span>" + tagValue + "</span><span class='a_update'><a href='#' onclick='return a_update_registClick(this);'>修改</a></span><span class='a_delete'><a href='#' onclick='return a_delete_registClick(this);'>删除</a></span>";
                    $(t).parent().parent().html(htl).after("<li><span></span><span class='a_addTag'><a href='#'  onclick='return a_addTag_registClick(this);'>添加标签</a></span></li>"); // 这一行 li
                    $("#browser").treeview({
					   add: branches
			      	});
                }

                //保存标签
                return false;
            }
        } 
        $(document).ready(function () {
            $(".a_update").each(function (t) {
                $(this).find("a").click(function () {
                    //修改的 方法
                    var txtValue = $(this).text();
                    if (txtValue == "修改") {
                        var m = $(this).parent().parent().find("span").first();
                        var oriTag = $(m).text();
                        $(m).html("<input type = 'text' value='" + oriTag + "'>");
                        $(this).text("保存");
                    } else {
                        var m = $(this).parent().parent().find("span").first();
                        var new_tag = $(m).find("input[type='text']").first().val();
                        $(m).text(new_tag);
                        $(this).text("修改");
                    }

                    return false;
                });
            });
            $(".a_delete").each(function () {
                $(this).find("a").click(function () {
                    //删除的方法
                    if (confirm("删除不可恢复,确定要删除吗?")) {
                        //将在这一个 li 隐藏,然后删除
                        $(this).parent().parent().hide();
                    }
                    return false;
                });
            });
            $(".a_addTag").each(function () {
                $(this).find("a").click(function () {
                    var txtValue = $(this).text();
                    if (txtValue == "添加标签") {
                        var m = $(this).parent().parent().find("span").first();
                        $(m).html("<input type = 'text' value=''>");
                        $(this).text("保存标签");
                        return false;
                    } else {
                        var m = $(this).parent().parent().find("span").first();
                        var tagValue = $(m).find("input[type='text']").first().val().trim();
                        if (tagValue == "") {
                            alert("标签内容不能为空");
                        } else {
                            var htl = "<span>" + tagValue + "</span><span class='a_update'><a href='#' onclick='return a_update_registClick(this);'>修改</a></span><span class='a_delete'><a href='#' onclick='return a_delete_registClick(this);'>删除</a></span>";
                            $(this).parent().parent().html(htl).after("<li><span></span><span class='a_addTag'><a href='#' onclick='return a_addTag_registClick(this);'>添加标签</a></span></li>"); // 这一行 li
                            
                            //<span>恶意攻击</span> <span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span>

                        }

                        //保存标签
                        return false;
                    }
                });
            });

        });


        $(function () {
            $("#btn_add").click(function () {
                var branches = "";
                 branches = $("<li><span>New Tag</span><span class='a_update_t'><a href='#' onclick='a_update_t_click(this);'>修改</a></span><span class='a_add_t'><a href='#' onclick='a_add__t_click(this);'>添加</a></span><ul>" +
					"</ul></li>").appendTo("#red");
                $("#red").treeview({
                    add: branches
                });
            });
            $("#red").bind("contextmenu", function (event) {
                if ($(event.target).is("li") || $(event.target).parents("li").length) {
                    $("#red").treeview({
                        remove: $(event.target).parents("li").filter(":first")
                    });
                    return false;
                }
            });
        });
        function a_add__t_click(t) {
            var branches = "";
            var ul_t = $(t).parent().parent().find("ul").first();
            branches = $("<li><span><input type = 'text' value=''></span><span class='a_update'><a href='#' onclick='return btn_save_click(this);'>保存</a></span></li>").prependTo(ul_t);
            $("#red").treeview({
                add: branches
            });
        }

        function btn_save_click(t) {
            var tagValue = $(t).parent().parent().find("span").first().find("input[type='text']").val().trim();
            var htl = "<span>" + tagValue + "</span><span class='a_update'><a href='#' onclick='return a_update_registClick(this);'>修改</a></span><span class='a_delete'><a href='#' onclick='return a_delete_registClick(this);'>删除</a></span>";
            $(t).parent().parent().html(htl)
            return false;
        }

        function a_update_t_click(t) {
            var txtValue = $(t).text();
            if (txtValue == "修改") {
                var m = $(t).parent().parent().find("span").first();
                var oriTag = $(m).text();
                $(m).html("<input type = 'text' value='" + oriTag + "'>");
                $(t).text("保存");
            } else {
                var m = $(t).parent().parent().find("span").first();
                var new_tag = $(m).find("input[type='text']").first().val().trim();
                if (new_tag == "") {
                    alert("标签不允许为空!");
                 }else {
                    $(m).text(new_tag);
                    $(t).text("修改");
                 }
            }
           return false;
        }
    </script>
</head>
<body>
    <h4>
       一级标签可以修改,但是不允许删除<br />
       二级标签可以修改和删除</h4>
    <input type="button" id="btn_add"  name="btn_add" value="新建一级标签" />
  <!--  <input type="button" id="btn_aa"  onclick="btn_aa();" name="btn_add" value="add" />-->
    <ul id="red" class="treeview-red">
        <li><span>产品</span><span class="a_update_t"><a href="#" onclick="a_update_t_click(this);">修改</a></span><span class="a_add_t"><a href="#" onclick="a_add__t_click(this);">添加</a></span>
            <ul>
                <li><span>裂纹</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
                <li><span>抓地力</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
                <li><span>恶意攻击</span> <span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
            </ul>
        </li>
        <li><span>品牌</span><span class="a_update_t"><a href="#" onclick="a_update_t_click(this);">修改</a></span><span class="a_add_t"><a href="#" onclick="a_add__t_click(this);">添加</a></span>
            <ul >
                <li><span>待遇/人事</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
                <li><span>品牌建设</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
            </ul>
        </li>
        <li><span>服务</span><span class="a_update_t"><a href="#" onclick="a_update_t_click(this);">修改</a></span><span class="a_add_t"><a href="#" onclick="a_add__t_click(this);">添加</a></span>
            <ul>
                <li><span>保养</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span></li>
                <li><span>售后质量</span><span class="a_update"><a href="#">修改</a></span><span class="a_delete"><a href="#">删除</a></span> </li>
            </ul>
        </li>
    </ul>

     <!--   <li><span></span><span class="a_addTag"><a href="#">添加标签</a></span></li>-->
</body>
</html>
